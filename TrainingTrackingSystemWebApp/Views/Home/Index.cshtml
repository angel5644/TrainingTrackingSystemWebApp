@model TrainingTrackingSystemWebApp.Controllers.HomeController.UsersIndexViewModel

@{
    ViewBag.Title = "Home Page";
}

<h1>Users List</h1>

<select id="search-field">
    <option value="firstName">First Name</option>
    <option value="lastName">Last Name</option>
</select>
<input type="text" id="search-value" />
<select id="order-type">
    <option value="asc">Ascending</option>
    <option value="desc">Descending</option>
</select>

<table>
    <thead>
        <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Type</th>
        </tr>
    </thead>
    <tbody id="users-data">
        @foreach (var user in Model.Users)
        {
            <tr>
                <td>@user.FirstName</td>
                <td>@user.LastName</td>
                <td>@user.Email</td>
                <td>@user.Type</td>
            </tr>
        }
    </tbody>
</table>



@section scripts{
    <script type="text/javascript">
        $("#search-value").on("keyup", "", function () {
            //console.log("We should filter the results here. Value: " + $(this).val());

            var searchField = $("#search-field").val();
            var searchValue = $(this).val();
            var orderType = $("#order-type").val();

            findUsers(searchField, searchValue, orderType);
        })

        $("#order-type").on("change", "", function () {
            var searchField = $("#search-field").val();
            //var searchValue = $(this).val();
            var orderType = $(this).val();

            findUsers(searchField, "", orderType);
        })

        function findUsers(searchField, searchValue, orderType) {

            $.ajax({
                url: "/Home/FindUsers",
                data: {
                    searchField: searchField,
                    searchValue: searchValue,
                    orderType: orderType
                },
                contentType: "application/json",
               // type: "GET",
                dataType: "json",
            })
                .done(function (data) {
                    
                    var $tableData = $("#users-data");
                    $tableData.html("");
                    
                    $.each(data.data, function (index, user) {
                        

                        var element = "<tr>";
                        element += "<td>" + user.FirstName + "</td>";
                        element += "<td>" + user.LastName + "</td>";
                        element += "<td>" + user.Email + "</td>";
                        element += "<td>" + user.Type + "</td>";
                        element += "</tr>";

                        $tableData.append(element);
                    })
                })
                .fail(function (jqXHR) {
                    console.log(jqXHR.responseText);
                })
        }
    </script>
}